global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'vizgenie-demo'
    environment: 'production'

scrape_configs:
  - job_name: 'fastapi-app'
    static_configs:
      - targets: ['fastapi-app:8000']
        labels:
          service: 'fastapi-app'
          app: 'demo-api'
    
    metrics_path: '/metrics'
    scrape_interval: 5s
    scrape_timeout: 5s

  # Docker service discovery (generic for any container)
  - job_name: 'docker-containers'
    docker_sd_configs:
      - host: unix:///var/run/docker.sock
        refresh_interval: 10s
    
    relabel_configs:
      # Only scrape containers with 'metrics' label
      - source_labels: [__meta_docker_container_label_metrics]
        regex: 'true'
        action: keep
      
      # Extract container name
      - source_labels: [__meta_docker_container_name]
        regex: '/(.*)'
        target_label: container
      
      # Extract service name from compose
      - source_labels: [__meta_docker_container_label_com_docker_compose_service]
        target_label: service
      
      # Extract metrics port
      - source_labels: [__meta_docker_container_label_metrics_port]
        regex: '(\d+)'
        target_label: __address__
        replacement: '${1}'
